@startuml
' Style visuel
skinparam class {
    BackgroundColor White
    ArrowColor Black
    BorderColor Black
}

' Table des utilisateurs
class Utilisateur {
    +id: INT <<PK>>
    +nom_utilisateur: VARCHAR(50) UNIQUE
    +email: VARCHAR(100) UNIQUE
    +mot_de_passe: TEXT
    +role: ENUM('visiteur', 'simple', 'complexe', 'admin')
    +age: INT
    +genre: VARCHAR(20)
    +date_naissance: DATE
    +type_membre: VARCHAR(50)
    +photo_profil: VARCHAR(255)
    +date_creation: TIMESTAMP
    +nom: VARCHAR(100)
    +prenom: VARCHAR(100)
    +niveau: ENUM('debutant', 'intermediaire', 'avance', 'expert')
    +points_experience: FLOAT
    +is_private_email: BOOLEAN
    +is_private_name: BOOLEAN
}

' Table des objets connectés
class ObjetConnecte {
    +id: INT <<PK>>
    +nom: VARCHAR(100)
    +description: TEXT
    +categorie: VARCHAR(50)
    +statut: ENUM('actif', 'inactif', 'maintenance')
    +emplacement: VARCHAR(100)
    +date_ajout: TIMESTAMP
    +derniere_mise_a_jour: TIMESTAMP
    +marque: VARCHAR(50)
    +type: VARCHAR(50)
    +connectivite: VARCHAR(50)
    +etat_batterie: INT
    +piece_id: INT <<FK>>
    +type_outil: ENUM('capteur', 'thermostat', 'gestion_transport', 'signalement_incident', 'gestion_acces')
    +description_outil: TEXT
    +capacite: INT
    +consommation_energie: FLOAT
    +niveau_de_bruit: INT
}

' Table des données collectées par les objets
class DonneeObjet {
    +id: INT <<PK>>
    +objet_id: INT <<FK>>
    +type_donnee: VARCHAR(50)
    +valeur: TEXT
    +date_relevee: TIMESTAMP
    +unite_mesure: VARCHAR(20)
}

' Table des pièces
class Piece {
    +id: INT <<PK>>
    +nom: VARCHAR(100)
    +description: TEXT
}

' Table des incidents
class Incident {
    +id: INT <<PK>>
    +objet_id: INT <<FK>>
    +utilisateur_id: INT <<FK>>
    +date_incident: TIMESTAMP
    +description: TEXT
    +statut: ENUM('ouvert', 'fermé', 'en cours')
}

' Table Activité Utilisateur
class ActiviteUtilisateur {
    +id: INT <<PK>>
    +utilisateur_id: INT <<FK>>
    +type_activite: ENUM('connexion', 'deconnexion', 'consultation_objet', 'ajout_objet', 'modification_profil', 'signalement_incident', 'modification_objet', 'suppression_objet')
    +date_activite: TIMESTAMP
    +details: TEXT
    +points_gagnes: FLOAT
    +adresse_ip: VARCHAR(45)
    +objet_id: INT
    +ancien_etat: TEXT ' JSON de l'état précédent de l'objet/profil (pour suivi des modifications)
    +nouvel_etat: TEXT ' JSON du nouvel état de l'objet/profil (pour suivi des modifications)
}

' Relations entre les tables
Utilisateur "1" -- "*" ObjetConnecte : possède
ObjetConnecte "1" -- "*" DonneeObjet : génère
ObjetConnecte "1" -- "1" Piece : est situé dans
ObjetConnecte "1" -- "*" Incident : est concerné par
Utilisateur "1" -- "*" Incident : signale
Utilisateur "1" -- "*" ActiviteUtilisateur : effectue
@enduml
