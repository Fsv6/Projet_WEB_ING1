{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { ref, onMounted } from 'vue';\nimport AppLayout from '@/layout/AppLayoutGlobal.vue';\nimport api from '@/services/api';\nimport { getPhotoUrl } from '@/utils/photo';\nexport default {\n  __name: 'ProfileView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const user = ref(null);\n    const oldPassword = ref('');\n    const newPassword = ref('');\n    const confirmPassword = ref('');\n    const photoFile = ref(null);\n    const photoPreview = ref(null);\n    onMounted(async () => {\n      try {\n        const res = await api.get('/users/me');\n        user.value = res.data;\n      } catch (err) {\n        console.error('Erreur chargement profil :', err);\n      }\n    });\n    const handlePhotoChange = e => {\n      const file = e.target.files[0];\n      if (!file) return;\n      if (!['image/png', 'image/jpeg'].includes(file.type)) {\n        alert('Seuls les formats PNG et JPEG sont accept√©s.');\n        return;\n      }\n      photoFile.value = file;\n      photoPreview.value = URL.createObjectURL(file);\n    };\n    const uploadPhoto = async () => {\n      if (!photoFile.value) {\n        alert(\"Veuillez choisir une image.\");\n        return;\n      }\n      const formData = new FormData();\n      formData.append('photo', photoFile.value);\n      try {\n        const res = await api.put('/users/me/photo', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        alert(\"Photo mise √† jour !\");\n        user.value.photo = res.data.photo;\n        photoPreview.value = null;\n        photoFile.value = null;\n      } catch (err) {\n        alert(\"Erreur lors de l'envoi de la photo\");\n        console.error(err);\n      }\n    };\n    const updatePassword = async () => {\n      if (!oldPassword.value || !newPassword.value || !confirmPassword.value) {\n        alert('Tous les champs sont obligatoires.');\n        return;\n      }\n      if (newPassword.value !== confirmPassword.value) {\n        alert('Les mots de passe ne correspondent pas.');\n        return;\n      }\n      try {\n        await api.put('/users/me', {\n          password: newPassword.value,\n          oldPassword: oldPassword.value\n        });\n        alert('Mot de passe mis √† jour');\n        oldPassword.value = '';\n        newPassword.value = '';\n        confirmPassword.value = '';\n      } catch (err) {\n        alert(\"Erreur lors de la mise √† jour : \" + (err.response?.data?.message || 'Inconnue'));\n      }\n    };\n    const __returned__ = {\n      user,\n      oldPassword,\n      newPassword,\n      confirmPassword,\n      photoFile,\n      photoPreview,\n      handlePhotoChange,\n      uploadPhoto,\n      updatePassword,\n      ref,\n      onMounted,\n      AppLayout,\n      get api() {\n        return api;\n      },\n      get getPhotoUrl() {\n        return getPhotoUrl;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","AppLayout","api","getPhotoUrl","user","oldPassword","newPassword","confirmPassword","photoFile","photoPreview","res","get","value","data","err","console","error","handlePhotoChange","e","file","target","files","includes","type","alert","URL","createObjectURL","uploadPhoto","formData","FormData","append","put","headers","photo","updatePassword","password","response","message"],"sources":["C:/Users/benab/Desktop/COURS 24_25/S2/WEB/V4/Projet_WEB_ING1/frontend/src/views/ProfileView.vue"],"sourcesContent":["<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport AppLayout from '@/layout/AppLayoutGlobal.vue'\r\nimport api from '@/services/api'\r\nimport { getPhotoUrl } from '@/utils/photo'\r\n\r\nconst user = ref(null)\r\nconst oldPassword = ref('')\r\nconst newPassword = ref('')\r\nconst confirmPassword = ref('')\r\nconst photoFile = ref(null)\r\nconst photoPreview = ref(null)\r\n\r\nonMounted(async () => {\r\n  try {\r\n    const res = await api.get('/users/me')\r\n    user.value = res.data\r\n  } catch (err) {\r\n    console.error('Erreur chargement profil :', err)\r\n  }\r\n})\r\n\r\nconst handlePhotoChange = (e) => {\r\n  const file = e.target.files[0]\r\n  if (!file) return\r\n  if (!['image/png', 'image/jpeg'].includes(file.type)) {\r\n    alert('Seuls les formats PNG et JPEG sont accept√©s.')\r\n    return\r\n  }\r\n  photoFile.value = file\r\n  photoPreview.value = URL.createObjectURL(file)\r\n}\r\n\r\nconst uploadPhoto = async () => {\r\n  if (!photoFile.value) {\r\n    alert(\"Veuillez choisir une image.\")\r\n    return\r\n  }\r\n\r\n  const formData = new FormData()\r\n  formData.append('photo', photoFile.value)\r\n\r\n  try {\r\n    const res = await api.put('/users/me/photo', formData, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data'\r\n      }\r\n    })\r\n    alert(\"Photo mise √† jour !\")\r\n    user.value.photo = res.data.photo\r\n    photoPreview.value = null\r\n    photoFile.value = null\r\n  } catch (err) {\r\n    alert(\"Erreur lors de l'envoi de la photo\")\r\n    console.error(err)\r\n  }\r\n}\r\n\r\n\r\nconst updatePassword = async () => {\r\n  if (!oldPassword.value || !newPassword.value || !confirmPassword.value) {\r\n    alert('Tous les champs sont obligatoires.')\r\n    return\r\n  }\r\n  if (newPassword.value !== confirmPassword.value) {\r\n    alert('Les mots de passe ne correspondent pas.')\r\n    return\r\n  }\r\n  try {\r\n    await api.put('/users/me', {\r\n      password: newPassword.value,\r\n      oldPassword: oldPassword.value\r\n    })\r\n    alert('Mot de passe mis √† jour')\r\n    oldPassword.value = ''\r\n    newPassword.value = ''\r\n    confirmPassword.value = ''\r\n  } catch (err) {\r\n    alert(\"Erreur lors de la mise √† jour : \" + (err.response?.data?.message || 'Inconnue'))\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <AppLayout>\r\n    <div class=\"profile-page\">\r\n      <h2>üë§ Mon Profil</h2>\r\n\r\n\r\n\r\n      <div class=\"section\">\r\n        <h3>üßæ Infos publiques</h3>\r\n        <p><strong>Pseudo :</strong> {{ user?.login }}</p>\r\n        <p><strong>Age :</strong> {{ user?.personne?.age || 'Non sp√©cifi√©' }}</p>\r\n        <p><strong>Genre :</strong> {{ user?.personne?.genre || 'Non sp√©cifi√©' }}</p>\r\n        <p><strong>Date de naissance :</strong> {{ user?.personne?.dateNaissance?.substring(0, 10) || 'Non sp√©cifi√©e' }}</p>\r\n        <p><strong>Type de membre :</strong> {{ user?.personne?.typeMembre || 'Non pr√©cis√©' }}</p>\r\n        <div class=\"section\">\r\n          <h3>üîê Infos priv√©es</h3>\r\n          <p><strong>Nom :</strong> {{ user?.personne?.nom || 'Non renseign√©' }}</p>\r\n          <p><strong>Pr√©nom :</strong> {{ user?.personne?.prenom || 'Non renseign√©' }}</p>\r\n        </div>\r\n\r\n        <div class=\"section\">\r\n          <h3>üñºÔ∏è Photo de profil</h3>\r\n\r\n          <img\r\n              :src=\"getPhotoUrl(user?.photo, user?._id)\"\r\n              alt=\"Photo de profil\"\r\n              class=\"avatar\"\r\n          />\r\n\r\n          <input type=\"file\" accept=\".png, .jpeg, .jpg\" @change=\"handlePhotoChange\" />\r\n          <img v-if=\"photoPreview\" :src=\"photoPreview\" alt=\"Preview\" class=\"preview\" />\r\n          <button class=\"btn\" @click=\"uploadPhoto\">Mettre √† jour la photo</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"section\">\r\n        <h3>üîí Changer le mot de passe</h3>\r\n        <input v-model=\"oldPassword\" type=\"password\" placeholder=\"Ancien mot de passe\" />\r\n        <input v-model=\"newPassword\" type=\"password\" placeholder=\"Nouveau mot de passe\" />\r\n        <input v-model=\"confirmPassword\" type=\"password\" placeholder=\"Confirmer le nouveau mot de passe\" />\r\n        <button class=\"btn\" @click=\"updatePassword\">Mettre √† jour le mot de passe</button>\r\n      </div>\r\n    </div>\r\n  </AppLayout>\r\n</template>\r\n\r\n<style scoped>\r\n.profile-page {\r\n  padding: 2rem;\r\n  max-width: 600px;\r\n  margin: auto;\r\n}\r\n.section {\r\n  background: #f8f8f8;\r\n  padding: 1.5rem;\r\n  border-radius: 8px;\r\n  margin-bottom: 2rem;\r\n}\r\n.preview {\r\n  width: 100px;\r\n  margin-top: 1rem;\r\n  border-radius: 6px;\r\n}\r\ninput {\r\n  display: block;\r\n  margin: 0.5rem 0;\r\n  padding: 0.5rem;\r\n  width: 100%;\r\n  border-radius: 4px;\r\n  border: 1px solid #ccc;\r\n}\r\nbutton.btn {\r\n  margin-top: 1rem;\r\n  padding: 0.5rem 1rem;\r\n  background-color: #2c3e50;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n}\r\n.avatar {\r\n  width: 120px;\r\n  height: 120px;\r\n  object-fit: cover;\r\n  border-radius: 50%;\r\n  margin-bottom: 1rem;\r\n  border: 2px solid #ccc;\r\n}\r\n\r\n</style>\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}