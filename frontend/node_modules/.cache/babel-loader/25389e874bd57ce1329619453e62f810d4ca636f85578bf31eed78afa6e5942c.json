{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { ref, onMounted, computed, watch } from 'vue';\nimport AppLayout from '@/layout/AppLayoutGlobal.vue';\nimport api from '@/services/api';\nimport defaultAvatar from '@/assets/default-avatar.png';\nimport { getPhotoUrl } from '@/utils/photo';\nexport default {\n  name: 'AdminHistory',\n  components: {\n    AppLayout\n  },\n  setup() {\n    const logs = ref([]);\n    const allUserActions = ref({}); // Stockage des actions d'aujourd'hui pour tous les utilisateurs\n    const currentPage = ref(1);\n    const totalPages = ref(1);\n    const loading = ref(false);\n    const expandedUsers = ref([]);\n    const expandedCategories = ref(new Map());\n    const searchTerm = ref('');\n    const selectedFamilleId = ref('');\n    const familles = ref([]);\n    const searchTimeout = ref(null);\n    const usersPerPage = 7; // Nombre d'utilisateurs par page\n    const errorMessage = ref('');\n    const selectedCategory = ref('');\n\n    // Extraire toutes les catégories d'action possibles à partir des logs ou d'une liste statique\n    const actionCategories = ['connexion', 'deconnexion', 'creation_utilisateur', 'modification_utilisateur', 'suppression_utilisateur', 'validation_compte', 'ajout_points', 'creation_famille', 'modification_famille', 'suppression_famille', 'ajout_membre_famille', 'retrait_membre_famille', 'creation_recette', 'modification_recette', 'suppression_recette', 'notation_recette', 'commentaire_recette', 'creation_objet', 'modification_objet', 'suppression_objet', 'utilisation_objet'];\n\n    // Chargement de toutes les actions d'aujourd'hui pour référence\n    const loadAllTodayActions = async () => {\n      try {\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const response = await api.get('/history?limit=1000'); // Demander un grand nombre pour avoir toutes les actions\n        const allLogs = response.data.histories || [];\n\n        // Compter les actions d'aujourd'hui par utilisateur\n        const actionsByUser = {};\n        allLogs.forEach(log => {\n          if (!log.user) return;\n          const actionDate = new Date(log.date);\n          const userEmail = log.user.email;\n          if (actionDate >= today) {\n            if (!actionsByUser[userEmail]) {\n              actionsByUser[userEmail] = {\n                count: 0,\n                user: log.user\n              };\n            }\n            actionsByUser[userEmail].count++;\n          }\n        });\n        allUserActions.value = actionsByUser;\n      } catch (error) {\n        console.error('Erreur lors du chargement des actions totales:', error);\n      }\n    };\n    const loadFamilles = async () => {\n      try {\n        const response = await api.get('/history/familles');\n        familles.value = response.data.familles || [];\n      } catch (error) {\n        console.error('Erreur lors du chargement des familles:', error);\n      }\n    };\n    const loadHistory = async (page = 1) => {\n      try {\n        loading.value = true;\n        errorMessage.value = '';\n        currentPage.value = page;\n        const params = new URLSearchParams();\n        params.append('page', page);\n        params.append('limit', 100); // Demander plus d'actions pour avoir assez d'utilisateurs distincts\n\n        if (searchTerm.value) {\n          params.append('search', searchTerm.value);\n        }\n        if (selectedFamilleId.value) {\n          params.append('familleId', selectedFamilleId.value);\n        }\n        const response = await api.get(`/history?${params.toString()}`);\n        logs.value = response.data.histories || [];\n        totalPages.value = response.data.pagination.pages;\n      } catch (error) {\n        console.error('Erreur lors du chargement de l\\'historique:', error);\n        logs.value = [];\n        errorMessage.value = \"Erreur lors du chargement de l'historique. Veuillez réessayer.\";\n      } finally {\n        loading.value = false;\n      }\n    };\n    const debounceSearch = () => {\n      if (searchTimeout.value) {\n        clearTimeout(searchTimeout.value);\n      }\n      searchTimeout.value = setTimeout(() => {\n        loadHistory(1); // Retour à la première page lors d'une recherche\n      }, 300); // Délai de 300ms pour éviter trop de requêtes\n    };\n\n    // Grouper les logs par utilisateur\n    const groupedByUser = computed(() => {\n      // Grouper les logs par utilisateur\n      const users = {};\n      logs.value.forEach(log => {\n        if (!log.user) return;\n        // Si filtre famille actif, ne garder que les utilisateurs de cette famille\n        if (selectedFamilleId.value && log.user.famille !== selectedFamilleId.value) return;\n        // Si filtre catégorie actif, ne garder que les actions de cette catégorie\n        if (selectedCategory.value && log.action !== selectedCategory.value) return;\n        const email = log.user.email;\n        if (!users[email]) {\n          users[email] = {\n            user: log.user,\n            categories: {}\n          };\n        }\n        if (!users[email].categories[log.action]) {\n          users[email].categories[log.action] = [];\n        }\n        users[email].categories[log.action].push(log);\n      });\n      return Object.values(users);\n    });\n\n    // Nombre total de pages d'utilisateurs (7 utilisateurs par page)\n    const totalUserPages = computed(() => {\n      return Math.ceil(groupedByUser.value.length / usersPerPage);\n    });\n\n    // Utilisateurs à afficher pour la page courante (pagination côté client)\n    const displayedUsers = computed(() => {\n      const start = (currentPage.value - 1) * usersPerPage;\n      const end = start + usersPerPage;\n\n      // S'assurer que nous avons des utilisateurs avec des actions correspondant au filtre\n      const filteredUsers = groupedByUser.value.filter(userHistory => {\n        // Si aucun filtre famille n'est appliqué, afficher cet utilisateur\n        if (!selectedFamilleId.value) {\n          return true;\n        }\n\n        // Vérifier si l'utilisateur a des actions liées à la famille sélectionnée\n        // (les logs ont déjà été filtrés par le backend, donc si l'utilisateur apparaît,\n        // c'est qu'il a au moins une action liée à cette famille)\n        return Object.values(userHistory.categories).some(actions => actions.length > 0);\n      });\n      return filteredUsers.slice(start, end);\n    });\n    const getTotalActions = categories => {\n      return Object.values(categories).reduce((total, actions) => total + actions.length, 0);\n    };\n    const getActionsToday = userEmail => {\n      return allUserActions.value[userEmail]?.count || 0;\n    };\n    const toggleUser = userEmail => {\n      const index = expandedUsers.value.indexOf(userEmail);\n      if (index === -1) {\n        expandedUsers.value.push(userEmail);\n      } else {\n        expandedUsers.value.splice(index, 1);\n        // Fermer toutes les catégories de cet utilisateur\n        expandedCategories.value.delete(userEmail);\n      }\n    };\n    const toggleCategory = (userEmail, category) => {\n      if (!expandedCategories.value.has(userEmail)) {\n        expandedCategories.value.set(userEmail, new Set());\n      }\n      const userCategories = expandedCategories.value.get(userEmail);\n      if (userCategories.has(category)) {\n        userCategories.delete(category);\n      } else {\n        userCategories.add(category);\n      }\n    };\n    const isExpandedCategory = (userEmail, category) => {\n      return expandedCategories.value.has(userEmail) && expandedCategories.value.get(userEmail).has(category);\n    };\n    const getCategoryIcon = action => {\n      const icons = {\n        // Utilisateurs\n        'connexion': 'fas fa-sign-in-alt',\n        'deconnexion': 'fas fa-sign-out-alt',\n        'creation_utilisateur': 'fas fa-user-plus',\n        'modification_utilisateur': 'fas fa-user-edit',\n        'suppression_utilisateur': 'fas fa-user-minus',\n        'validation_compte': 'fas fa-user-check',\n        'ajout_points': 'fas fa-star',\n        // Familles\n        'creation_famille': 'fas fa-users-cog',\n        'modification_famille': 'fas fa-users-cog',\n        'suppression_famille': 'fas fa-users-slash',\n        'ajout_membre_famille': 'fas fa-user-plus',\n        'retrait_membre_famille': 'fas fa-user-minus',\n        // Recettes\n        'creation_recette': 'fas fa-utensils',\n        'modification_recette': 'fas fa-edit',\n        'suppression_recette': 'fas fa-trash-alt',\n        'notation_recette': 'fas fa-star',\n        'commentaire_recette': 'fas fa-comment',\n        // Objets/Ingrédients\n        'creation_objet': 'fas fa-plus-circle',\n        'modification_objet': 'fas fa-edit',\n        'suppression_objet': 'fas fa-trash-alt',\n        'utilisation_objet': 'fas fa-hand-pointer'\n      };\n      return icons[action] || 'fas fa-history';\n    };\n    const formatDate = date => {\n      return new Date(date).toLocaleString('fr-FR', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    };\n    const formatAction = action => {\n      const actions = {\n        // Utilisateurs\n        'connexion': 'Connexions',\n        'deconnexion': 'Déconnexions',\n        'creation_utilisateur': 'Créations d\\'utilisateurs',\n        'modification_utilisateur': 'Modifications d\\'utilisateurs',\n        'suppression_utilisateur': 'Suppressions d\\'utilisateurs',\n        'validation_compte': 'Validations de compte',\n        'ajout_points': 'Ajouts de points',\n        // Familles\n        'creation_famille': 'Créations de familles',\n        'modification_famille': 'Modifications de familles',\n        'suppression_famille': 'Suppressions de familles',\n        'ajout_membre_famille': 'Ajouts de membres',\n        'retrait_membre_famille': 'Retraits de membres',\n        // Recettes\n        'creation_recette': 'Créations de recettes',\n        'modification_recette': 'Modifications de recettes',\n        'suppression_recette': 'Suppressions de recettes',\n        'notation_recette': 'Notations de recettes',\n        'commentaire_recette': 'Commentaires de recettes',\n        // Objets/Ingrédients\n        'creation_objet': 'Créations d\\'objets',\n        'modification_objet': 'Modifications d\\'objets',\n        'suppression_objet': 'Suppressions d\\'objets',\n        'utilisation_objet': 'Utilisations d\\'objets'\n      };\n      return actions[action] || action;\n    };\n    const getActionClass = action => {\n      const actionType = action.split('_')[0];\n      const classes = {\n        'connexion': 'action-connexion',\n        'deconnexion': 'action-deconnexion',\n        'creation': 'action-creation',\n        'modification': 'action-modification',\n        'suppression': 'action-suppression',\n        'ajout': 'action-ajout',\n        'retrait': 'action-retrait',\n        'validation': 'action-validation',\n        'notation': 'action-notation',\n        'commentaire': 'action-commentaire',\n        'utilisation': 'action-utilisation'\n      };\n      return classes[actionType] || '';\n    };\n    const formatDetailKey = key => {\n      return key.charAt(0).toUpperCase() + key.slice(1).replace(/_/g, ' ');\n    };\n    const formatUserAgent = userAgent => {\n      if (!userAgent) return '';\n      return userAgent.split(' ')[0];\n    };\n    const changePage = page => {\n      if (page >= 1 && page <= totalUserPages.value) {\n        currentPage.value = page;\n\n        // Si on change de page, on ferme tous les utilisateurs développés\n        expandedUsers.value = [];\n        expandedCategories.value = new Map();\n      }\n    };\n    onMounted(() => {\n      loadAllTodayActions(); // Charger d'abord toutes les actions d'aujourd'hui\n      loadHistory();\n      loadFamilles();\n    });\n\n    // Réinitialiser la page quand les filtres changent\n    watch([selectedFamilleId, searchTerm], () => {\n      if (currentPage.value !== 1) {\n        currentPage.value = 1;\n      }\n      // Recharger l'historique quand les filtres changent\n      loadHistory(1);\n    });\n    return {\n      logs,\n      allUserActions,\n      currentPage,\n      totalPages,\n      totalUserPages,\n      groupedByUser,\n      displayedUsers,\n      expandedUsers,\n      defaultAvatar,\n      formatDate,\n      formatAction,\n      getActionClass,\n      getCategoryIcon,\n      formatDetailKey,\n      formatUserAgent,\n      toggleUser,\n      toggleCategory,\n      isExpandedCategory,\n      getTotalActions,\n      getActionsToday,\n      changePage,\n      searchTerm,\n      selectedFamilleId,\n      familles,\n      debounceSearch,\n      loading,\n      getPhotoUrl,\n      errorMessage,\n      selectedCategory,\n      actionCategories\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","watch","AppLayout","api","defaultAvatar","getPhotoUrl","name","components","setup","logs","allUserActions","currentPage","totalPages","loading","expandedUsers","expandedCategories","Map","searchTerm","selectedFamilleId","familles","searchTimeout","usersPerPage","errorMessage","selectedCategory","actionCategories","loadAllTodayActions","today","Date","setHours","response","get","allLogs","data","histories","actionsByUser","forEach","log","user","actionDate","date","userEmail","email","count","value","error","console","loadFamilles","loadHistory","page","params","URLSearchParams","append","toString","pagination","pages","debounceSearch","clearTimeout","setTimeout","groupedByUser","users","famille","action","categories","push","Object","values","totalUserPages","Math","ceil","length","displayedUsers","start","end","filteredUsers","filter","userHistory","some","actions","slice","getTotalActions","reduce","total","getActionsToday","toggleUser","index","indexOf","splice","delete","toggleCategory","category","has","set","Set","userCategories","add","isExpandedCategory","getCategoryIcon","icons","formatDate","toLocaleString","day","month","year","hour","minute","formatAction","getActionClass","actionType","split","classes","formatDetailKey","key","charAt","toUpperCase","replace","formatUserAgent","userAgent","changePage"],"sources":["C:\\Users\\benab\\Desktop\\COURS 24_25\\S2\\WEB\\V4\\Projet_WEB_ING1\\frontend\\src\\views\\AdminHistory.vue"],"sourcesContent":["<template>\r\n  <AppLayout>\r\n    <div class=\"history-container\">\r\n      <h1 class=\"page-title\">Historique des actions</h1>\r\n\r\n      <!-- Message d'erreur -->\r\n      <div v-if=\"errorMessage\" class=\"error-message\">\r\n        <i class=\"fas fa-exclamation-triangle\"></i> {{ errorMessage }}\r\n      </div>\r\n\r\n      <!-- Filtres et recherche -->\r\n      <div class=\"filters-container\">\r\n        <div class=\"search-box\">\r\n          <input\r\n              type=\"text\"\r\n              v-model=\"searchTerm\"\r\n              placeholder=\"Rechercher...\"\r\n              @input=\"debounceSearch\"\r\n          />\r\n          <i class=\"fas fa-search search-icon\"></i>\r\n        </div>\r\n\r\n        <div class=\"family-filter\">\r\n          <select id=\"family-select\" v-model=\"selectedFamilleId\" @change=\"debounceSearch()\">\r\n            <option value=\"\">Toutes les familles</option>\r\n            <option v-for=\"famille in familles\" :key=\"famille._id\" :value=\"famille._id\">\r\n              {{ famille.codeFamille || famille._id }}\r\n            </option>\r\n          </select>\r\n        </div>\r\n\r\n        <div class=\"category-filter\">\r\n          <select v-model=\"selectedCategory\" @change=\"debounceSearch()\">\r\n            <option value=\"\">Toutes les catégories</option>\r\n            <option v-for=\"cat in actionCategories\" :key=\"cat\" :value=\"cat\">\r\n              {{ formatAction(cat) }}\r\n            </option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Affichage du message si aucun résultat -->\r\n      <div v-if=\"logs.length === 0 && !loading\" class=\"no-results\">\r\n        <p>Aucun résultat ne correspond à votre recherche</p>\r\n      </div>\r\n\r\n      <!-- Liste des utilisateurs -->\r\n      <div class=\"users-container\">\r\n        <div v-for=\"(userHistory, index) in displayedUsers\" :key=\"index\" class=\"user-card\">\r\n          <div class=\"user-header\" @click=\"toggleUser(userHistory.user.email)\">\r\n            <div class=\"user-info\">\r\n              <img :src=\"getPhotoUrl(userHistory.user.photo, userHistory.user._id)\" class=\"user-avatar\" alt=\"Avatar\">\r\n              <div class=\"user-details\">\r\n                <h3>{{ userHistory.user.email }}</h3>\r\n                <span class=\"action-count\">\r\n                  {{ getActionsToday(userHistory.user.email) }} action(s) aujourd'hui\r\n                </span>\r\n              </div>\r\n            </div>\r\n            <div class=\"expand-button\" :class=\"{ 'expanded': expandedUsers.includes(userHistory.user.email) }\">\r\n              <i class=\"fas fa-chevron-down\"></i>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Catégories d'actions de l'utilisateur -->\r\n          <div v-if=\"expandedUsers.includes(userHistory.user.email)\" class=\"categories-container\">\r\n            <div v-for=\"(actions, category) in userHistory.categories\" :key=\"category\" class=\"category-section\">\r\n              <div class=\"category-header\" @click=\"toggleCategory(userHistory.user.email, category)\">\r\n                <div class=\"category-info\">\r\n                  <span :class=\"['category-icon', getActionClass(category)]\">\r\n                    <i :class=\"getCategoryIcon(category)\"></i>\r\n                  </span>\r\n                  <div class=\"category-details\">\r\n                    <h4>{{ formatAction(category) }}</h4>\r\n                    <span class=\"category-count\">{{ actions.length }} action(s)</span>\r\n                  </div>\r\n                </div>\r\n                <div class=\"category-meta\">\r\n                  <span class=\"last-update-date\">Dernière action: {{ formatDate(actions[0].date) }}</span>\r\n                  <div class=\"expand-button\" :class=\"{ 'expanded': isExpandedCategory(userHistory.user.email, category) }\">\r\n                    <i class=\"fas fa-chevron-down\"></i>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <!-- Timeline des actions de la catégorie -->\r\n              <div v-if=\"isExpandedCategory(userHistory.user.email, category)\" class=\"timeline-container\">\r\n                <div class=\"timeline\">\r\n                  <div v-for=\"action in actions\" :key=\"action._id\" class=\"timeline-item\">\r\n                    <div class=\"timeline-point\" :class=\"getActionClass(category)\"></div>\r\n                    <div class=\"timeline-content\">\r\n                      <div class=\"action-header\">\r\n                        <span class=\"action-date\">{{ formatDate(action.date) }}</span>\r\n                      </div>\r\n                      <div class=\"action-details\" v-if=\"action.details\">\r\n                        <div v-for=\"(value, key) in action.details\" :key=\"key\" class=\"detail-item\">\r\n                          <span class=\"detail-label\">{{ formatDetailKey(key) }}:</span>\r\n                          <span class=\"detail-value\">{{ value }}</span>\r\n                        </div>\r\n                      </div>\r\n                      <div class=\"action-meta\">\r\n                        <span class=\"meta-item\" v-if=\"action.ip\">\r\n                          <i class=\"fas fa-network-wired\"></i> {{ action.ip }}\r\n                        </span>\r\n                        <span class=\"meta-item\" v-if=\"action.userAgent\">\r\n                          <i class=\"fas fa-laptop\"></i> {{ formatUserAgent(action.userAgent) }}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Pagination -->\r\n      <div class=\"pagination\" v-if=\"totalUserPages > 1\">\r\n        <button\r\n            :disabled=\"currentPage === 1\"\r\n            @click=\"changePage(currentPage - 1)\"\r\n            class=\"page-btn\"\r\n        >\r\n          <i class=\"fas fa-chevron-left\"></i> Précédent\r\n        </button>\r\n        <span class=\"page-info\">Page {{ currentPage }} sur {{ totalUserPages }}</span>\r\n        <button\r\n            :disabled=\"currentPage === totalUserPages\"\r\n            @click=\"changePage(currentPage + 1)\"\r\n            class=\"page-btn\"\r\n        >\r\n          Suivant <i class=\"fas fa-chevron-right\"></i>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </AppLayout>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, computed, watch } from 'vue';\r\nimport AppLayout from '@/layout/AppLayoutGlobal.vue';\r\nimport api from '@/services/api';\r\nimport defaultAvatar from '@/assets/default-avatar.png';\r\nimport { getPhotoUrl } from '@/utils/photo';\r\n\r\nexport default {\r\n  name: 'AdminHistory',\r\n  components: {\r\n    AppLayout\r\n  },\r\n  setup() {\r\n    const logs = ref([]);\r\n    const allUserActions = ref({}); // Stockage des actions d'aujourd'hui pour tous les utilisateurs\r\n    const currentPage = ref(1);\r\n    const totalPages = ref(1);\r\n    const loading = ref(false);\r\n    const expandedUsers = ref([]);\r\n    const expandedCategories = ref(new Map());\r\n    const searchTerm = ref('');\r\n    const selectedFamilleId = ref('');\r\n    const familles = ref([]);\r\n    const searchTimeout = ref(null);\r\n    const usersPerPage = 7; // Nombre d'utilisateurs par page\r\n    const errorMessage = ref('');\r\n    const selectedCategory = ref('');\r\n\r\n    // Extraire toutes les catégories d'action possibles à partir des logs ou d'une liste statique\r\n    const actionCategories = [\r\n      'connexion', 'deconnexion', 'creation_utilisateur', 'modification_utilisateur', 'suppression_utilisateur', 'validation_compte', 'ajout_points',\r\n      'creation_famille', 'modification_famille', 'suppression_famille', 'ajout_membre_famille', 'retrait_membre_famille',\r\n      'creation_recette', 'modification_recette', 'suppression_recette', 'notation_recette', 'commentaire_recette',\r\n      'creation_objet', 'modification_objet', 'suppression_objet', 'utilisation_objet'\r\n    ];\r\n\r\n    // Chargement de toutes les actions d'aujourd'hui pour référence\r\n    const loadAllTodayActions = async () => {\r\n      try {\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n\r\n        const response = await api.get('/history?limit=1000'); // Demander un grand nombre pour avoir toutes les actions\r\n        const allLogs = response.data.histories || [];\r\n\r\n        // Compter les actions d'aujourd'hui par utilisateur\r\n        const actionsByUser = {};\r\n\r\n        allLogs.forEach(log => {\r\n          if (!log.user) return;\r\n\r\n          const actionDate = new Date(log.date);\r\n          const userEmail = log.user.email;\r\n\r\n          if (actionDate >= today) {\r\n            if (!actionsByUser[userEmail]) {\r\n              actionsByUser[userEmail] = {\r\n                count: 0,\r\n                user: log.user\r\n              };\r\n            }\r\n            actionsByUser[userEmail].count++;\r\n          }\r\n        });\r\n\r\n        allUserActions.value = actionsByUser;\r\n      } catch (error) {\r\n        console.error('Erreur lors du chargement des actions totales:', error);\r\n      }\r\n    };\r\n\r\n    const loadFamilles = async () => {\r\n      try {\r\n        const response = await api.get('/history/familles');\r\n        familles.value = response.data.familles || [];\r\n      } catch (error) {\r\n        console.error('Erreur lors du chargement des familles:', error);\r\n      }\r\n    };\r\n\r\n    const loadHistory = async (page = 1) => {\r\n      try {\r\n        loading.value = true;\r\n        errorMessage.value = '';\r\n        currentPage.value = page;\r\n\r\n        const params = new URLSearchParams();\r\n        params.append('page', page);\r\n        params.append('limit', 100); // Demander plus d'actions pour avoir assez d'utilisateurs distincts\r\n\r\n        if (searchTerm.value) {\r\n          params.append('search', searchTerm.value);\r\n        }\r\n\r\n        if (selectedFamilleId.value) {\r\n          params.append('familleId', selectedFamilleId.value);\r\n        }\r\n\r\n        const response = await api.get(`/history?${params.toString()}`);\r\n        logs.value = response.data.histories || [];\r\n        totalPages.value = response.data.pagination.pages;\r\n      } catch (error) {\r\n        console.error('Erreur lors du chargement de l\\'historique:', error);\r\n        logs.value = [];\r\n        errorMessage.value = \"Erreur lors du chargement de l'historique. Veuillez réessayer.\";\r\n      } finally {\r\n        loading.value = false;\r\n      }\r\n    };\r\n\r\n    const debounceSearch = () => {\r\n      if (searchTimeout.value) {\r\n        clearTimeout(searchTimeout.value);\r\n      }\r\n\r\n      searchTimeout.value = setTimeout(() => {\r\n        loadHistory(1); // Retour à la première page lors d'une recherche\r\n      }, 300); // Délai de 300ms pour éviter trop de requêtes\r\n    };\r\n\r\n    // Grouper les logs par utilisateur\r\n    const groupedByUser = computed(() => {\r\n      // Grouper les logs par utilisateur\r\n      const users = {};\r\n      logs.value.forEach(log => {\r\n        if (!log.user) return;\r\n        // Si filtre famille actif, ne garder que les utilisateurs de cette famille\r\n        if (selectedFamilleId.value && log.user.famille !== selectedFamilleId.value) return;\r\n        // Si filtre catégorie actif, ne garder que les actions de cette catégorie\r\n        if (selectedCategory.value && log.action !== selectedCategory.value) return;\r\n        const email = log.user.email;\r\n        if (!users[email]) {\r\n          users[email] = { user: log.user, categories: {} };\r\n        }\r\n        if (!users[email].categories[log.action]) {\r\n          users[email].categories[log.action] = [];\r\n        }\r\n        users[email].categories[log.action].push(log);\r\n      });\r\n      return Object.values(users);\r\n    });\r\n\r\n    // Nombre total de pages d'utilisateurs (7 utilisateurs par page)\r\n    const totalUserPages = computed(() => {\r\n      return Math.ceil(groupedByUser.value.length / usersPerPage);\r\n    });\r\n\r\n    // Utilisateurs à afficher pour la page courante (pagination côté client)\r\n    const displayedUsers = computed(() => {\r\n      const start = (currentPage.value - 1) * usersPerPage;\r\n      const end = start + usersPerPage;\r\n\r\n      // S'assurer que nous avons des utilisateurs avec des actions correspondant au filtre\r\n      const filteredUsers = groupedByUser.value.filter(userHistory => {\r\n        // Si aucun filtre famille n'est appliqué, afficher cet utilisateur\r\n        if (!selectedFamilleId.value) {\r\n          return true;\r\n        }\r\n\r\n        // Vérifier si l'utilisateur a des actions liées à la famille sélectionnée\r\n        // (les logs ont déjà été filtrés par le backend, donc si l'utilisateur apparaît,\r\n        // c'est qu'il a au moins une action liée à cette famille)\r\n        return Object.values(userHistory.categories).some(actions => actions.length > 0);\r\n      });\r\n\r\n      return filteredUsers.slice(start, end);\r\n    });\r\n\r\n    const getTotalActions = (categories) => {\r\n      return Object.values(categories).reduce((total, actions) => total + actions.length, 0);\r\n    };\r\n\r\n    const getActionsToday = (userEmail) => {\r\n      return allUserActions.value[userEmail]?.count || 0;\r\n    };\r\n\r\n    const toggleUser = (userEmail) => {\r\n      const index = expandedUsers.value.indexOf(userEmail);\r\n      if (index === -1) {\r\n        expandedUsers.value.push(userEmail);\r\n      } else {\r\n        expandedUsers.value.splice(index, 1);\r\n        // Fermer toutes les catégories de cet utilisateur\r\n        expandedCategories.value.delete(userEmail);\r\n      }\r\n    };\r\n\r\n    const toggleCategory = (userEmail, category) => {\r\n      if (!expandedCategories.value.has(userEmail)) {\r\n        expandedCategories.value.set(userEmail, new Set());\r\n      }\r\n\r\n      const userCategories = expandedCategories.value.get(userEmail);\r\n      if (userCategories.has(category)) {\r\n        userCategories.delete(category);\r\n      } else {\r\n        userCategories.add(category);\r\n      }\r\n    };\r\n\r\n    const isExpandedCategory = (userEmail, category) => {\r\n      return expandedCategories.value.has(userEmail) &&\r\n          expandedCategories.value.get(userEmail).has(category);\r\n    };\r\n\r\n    const getCategoryIcon = (action) => {\r\n      const icons = {\r\n        // Utilisateurs\r\n        'connexion': 'fas fa-sign-in-alt',\r\n        'deconnexion': 'fas fa-sign-out-alt',\r\n        'creation_utilisateur': 'fas fa-user-plus',\r\n        'modification_utilisateur': 'fas fa-user-edit',\r\n        'suppression_utilisateur': 'fas fa-user-minus',\r\n        'validation_compte': 'fas fa-user-check',\r\n        'ajout_points': 'fas fa-star',\r\n\r\n        // Familles\r\n        'creation_famille': 'fas fa-users-cog',\r\n        'modification_famille': 'fas fa-users-cog',\r\n        'suppression_famille': 'fas fa-users-slash',\r\n        'ajout_membre_famille': 'fas fa-user-plus',\r\n        'retrait_membre_famille': 'fas fa-user-minus',\r\n\r\n        // Recettes\r\n        'creation_recette': 'fas fa-utensils',\r\n        'modification_recette': 'fas fa-edit',\r\n        'suppression_recette': 'fas fa-trash-alt',\r\n        'notation_recette': 'fas fa-star',\r\n        'commentaire_recette': 'fas fa-comment',\r\n\r\n        // Objets/Ingrédients\r\n        'creation_objet': 'fas fa-plus-circle',\r\n        'modification_objet': 'fas fa-edit',\r\n        'suppression_objet': 'fas fa-trash-alt',\r\n        'utilisation_objet': 'fas fa-hand-pointer'\r\n      };\r\n      return icons[action] || 'fas fa-history';\r\n    };\r\n\r\n    const formatDate = (date) => {\r\n      return new Date(date).toLocaleString('fr-FR', {\r\n        day: '2-digit',\r\n        month: '2-digit',\r\n        year: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n      });\r\n    };\r\n\r\n    const formatAction = (action) => {\r\n      const actions = {\r\n        // Utilisateurs\r\n        'connexion': 'Connexions',\r\n        'deconnexion': 'Déconnexions',\r\n        'creation_utilisateur': 'Créations d\\'utilisateurs',\r\n        'modification_utilisateur': 'Modifications d\\'utilisateurs',\r\n        'suppression_utilisateur': 'Suppressions d\\'utilisateurs',\r\n        'validation_compte': 'Validations de compte',\r\n        'ajout_points': 'Ajouts de points',\r\n\r\n        // Familles\r\n        'creation_famille': 'Créations de familles',\r\n        'modification_famille': 'Modifications de familles',\r\n        'suppression_famille': 'Suppressions de familles',\r\n        'ajout_membre_famille': 'Ajouts de membres',\r\n        'retrait_membre_famille': 'Retraits de membres',\r\n\r\n        // Recettes\r\n        'creation_recette': 'Créations de recettes',\r\n        'modification_recette': 'Modifications de recettes',\r\n        'suppression_recette': 'Suppressions de recettes',\r\n        'notation_recette': 'Notations de recettes',\r\n        'commentaire_recette': 'Commentaires de recettes',\r\n\r\n        // Objets/Ingrédients\r\n        'creation_objet': 'Créations d\\'objets',\r\n        'modification_objet': 'Modifications d\\'objets',\r\n        'suppression_objet': 'Suppressions d\\'objets',\r\n        'utilisation_objet': 'Utilisations d\\'objets'\r\n      };\r\n      return actions[action] || action;\r\n    };\r\n\r\n    const getActionClass = (action) => {\r\n      const actionType = action.split('_')[0];\r\n      const classes = {\r\n        'connexion': 'action-connexion',\r\n        'deconnexion': 'action-deconnexion',\r\n        'creation': 'action-creation',\r\n        'modification': 'action-modification',\r\n        'suppression': 'action-suppression',\r\n        'ajout': 'action-ajout',\r\n        'retrait': 'action-retrait',\r\n        'validation': 'action-validation',\r\n        'notation': 'action-notation',\r\n        'commentaire': 'action-commentaire',\r\n        'utilisation': 'action-utilisation'\r\n      };\r\n      return classes[actionType] || '';\r\n    };\r\n\r\n    const formatDetailKey = (key) => {\r\n      return key.charAt(0).toUpperCase() + key.slice(1).replace(/_/g, ' ');\r\n    };\r\n\r\n    const formatUserAgent = (userAgent) => {\r\n      if (!userAgent) return '';\r\n      return userAgent.split(' ')[0];\r\n    };\r\n\r\n    const changePage = (page) => {\r\n      if (page >= 1 && page <= totalUserPages.value) {\r\n        currentPage.value = page;\r\n\r\n        // Si on change de page, on ferme tous les utilisateurs développés\r\n        expandedUsers.value = [];\r\n        expandedCategories.value = new Map();\r\n      }\r\n    };\r\n\r\n    onMounted(() => {\r\n      loadAllTodayActions(); // Charger d'abord toutes les actions d'aujourd'hui\r\n      loadHistory();\r\n      loadFamilles();\r\n    });\r\n\r\n    // Réinitialiser la page quand les filtres changent\r\n    watch([selectedFamilleId, searchTerm], () => {\r\n      if (currentPage.value !== 1) {\r\n        currentPage.value = 1;\r\n      }\r\n      // Recharger l'historique quand les filtres changent\r\n      loadHistory(1);\r\n    });\r\n\r\n    return {\r\n      logs,\r\n      allUserActions,\r\n      currentPage,\r\n      totalPages,\r\n      totalUserPages,\r\n      groupedByUser,\r\n      displayedUsers,\r\n      expandedUsers,\r\n      defaultAvatar,\r\n      formatDate,\r\n      formatAction,\r\n      getActionClass,\r\n      getCategoryIcon,\r\n      formatDetailKey,\r\n      formatUserAgent,\r\n      toggleUser,\r\n      toggleCategory,\r\n      isExpandedCategory,\r\n      getTotalActions,\r\n      getActionsToday,\r\n      changePage,\r\n      searchTerm,\r\n      selectedFamilleId,\r\n      familles,\r\n      debounceSearch,\r\n      loading,\r\n      getPhotoUrl,\r\n      errorMessage,\r\n      selectedCategory,\r\n      actionCategories\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.history-container {\r\n  padding: 20px;\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.page-title {\r\n  color: #2c5038;\r\n  margin-bottom: 30px;\r\n  font-size: 2rem;\r\n}\r\n\r\n/* Styles pour les filtres */\r\n.filters-container {\r\n  display: flex;\r\n  gap: 15px;\r\n  margin-bottom: 20px;\r\n  align-items: center;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.search-box {\r\n  position: relative;\r\n  flex: 1;\r\n  min-width: 200px;\r\n}\r\n\r\n.search-box input {\r\n  width: 100%;\r\n  padding: 10px 15px 10px 40px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 30px;\r\n  font-size: 1rem;\r\n  outline: none;\r\n  transition: border-color 0.3s;\r\n}\r\n\r\n.search-box input:focus {\r\n  border-color: #2c5038;\r\n}\r\n\r\n.search-icon {\r\n  position: absolute;\r\n  left: 15px;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  color: #666;\r\n}\r\n\r\n.family-filter, .category-filter {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n}\r\n\r\n.family-filter label {\r\n  font-weight: bold;\r\n  color: #2c5038;\r\n}\r\n\r\n.family-filter select {\r\n  padding: 8px 15px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 5px;\r\n  outline: none;\r\n  background-color: white;\r\n  font-size: 1rem;\r\n  min-width: 150px;\r\n}\r\n\r\n.category-filter select {\r\n  padding: 8px 15px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 5px;\r\n  outline: none;\r\n  background-color: white;\r\n  font-size: 1rem;\r\n  min-width: 170px;\r\n}\r\n\r\n.users-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20px;\r\n}\r\n\r\n.user-card {\r\n  background: white;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n  overflow: hidden;\r\n}\r\n\r\n.user-header {\r\n  padding: 15px 20px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s;\r\n  background-color: #f8f9fa;\r\n}\r\n\r\n.user-header:hover {\r\n  background-color: #e9ecef;\r\n}\r\n\r\n.user-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 15px;\r\n}\r\n\r\n.user-avatar {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  object-fit: cover;\r\n}\r\n\r\n.user-details h3 {\r\n  margin: 0;\r\n  font-size: 1.1rem;\r\n  color: #2c5038;\r\n}\r\n\r\n.action-count {\r\n  font-size: 0.9rem;\r\n  color: #666;\r\n}\r\n\r\n.categories-container {\r\n  padding: 15px;\r\n  background-color: white;\r\n}\r\n\r\n.category-section {\r\n  margin-bottom: 15px;\r\n  border: 1px solid #eee;\r\n  border-radius: 8px;\r\n  overflow: hidden;\r\n}\r\n\r\n.category-header {\r\n  padding: 12px 15px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s;\r\n  background-color: #fff;\r\n}\r\n\r\n.category-header:hover {\r\n  background-color: #f8f9fa;\r\n}\r\n\r\n.category-info {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n}\r\n\r\n.category-icon {\r\n  width: 32px;\r\n  height: 32px;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: white;\r\n  font-size: 1rem;\r\n}\r\n\r\n.category-details h4 {\r\n  margin: 0;\r\n  font-size: 1rem;\r\n  color: #2c5038;\r\n}\r\n\r\n.category-count {\r\n  font-size: 0.8rem;\r\n  color: #666;\r\n}\r\n\r\n.category-meta {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n}\r\n\r\n.last-update-date {\r\n  font-size: 0.8rem;\r\n  color: #888;\r\n  font-style: italic;\r\n}\r\n\r\n.expand-button {\r\n  transition: transform 0.3s;\r\n}\r\n\r\n.expand-button.expanded {\r\n  transform: rotate(180deg);\r\n}\r\n\r\n.timeline-container {\r\n  padding: 15px;\r\n  background-color: #f8f9fa;\r\n}\r\n\r\n.timeline {\r\n  position: relative;\r\n  padding-left: 30px;\r\n}\r\n\r\n.timeline::before {\r\n  content: '';\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  bottom: 0;\r\n  width: 2px;\r\n  background-color: #ddd;\r\n}\r\n\r\n.timeline-item {\r\n  position: relative;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.timeline-point {\r\n  position: absolute;\r\n  left: -34px;\r\n  width: 12px;\r\n  height: 12px;\r\n  border-radius: 50%;\r\n  border: 2px solid white;\r\n}\r\n\r\n.timeline-content {\r\n  background: white;\r\n  border-radius: 8px;\r\n  padding: 15px;\r\n  box-shadow: 0 1px 3px rgba(0,0,0,0.1);\r\n}\r\n\r\n.action-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.action-date {\r\n  font-size: 0.9em;\r\n  color: #666;\r\n}\r\n\r\n.action-details {\r\n  margin: 10px 0;\r\n  font-size: 0.9em;\r\n}\r\n\r\n.detail-item {\r\n  margin: 5px 0;\r\n}\r\n\r\n.detail-label {\r\n  font-weight: 500;\r\n  color: #666;\r\n}\r\n\r\n.action-meta {\r\n  margin-top: 10px;\r\n  display: flex;\r\n  gap: 15px;\r\n  font-size: 0.85em;\r\n  color: #666;\r\n}\r\n\r\n.meta-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 5px;\r\n}\r\n\r\n/* Classes pour les différentes actions */\r\n.action-connexion {\r\n  color: #4a6fa5;\r\n  background-color: rgba(74, 111, 165, 0.1);\r\n}\r\n\r\n.action-deconnexion {\r\n  color: #6c757d;\r\n  background-color: rgba(108, 117, 125, 0.1);\r\n}\r\n\r\n.action-creation {\r\n  color: #28a745;\r\n  background-color: rgba(40, 167, 69, 0.1);\r\n}\r\n\r\n.action-modification {\r\n  color: #17a2b8;\r\n  background-color: rgba(23, 162, 184, 0.1);\r\n}\r\n\r\n.action-suppression {\r\n  color: #dc3545;\r\n  background-color: rgba(220, 53, 69, 0.1);\r\n}\r\n\r\n.action-ajout, .action-points {\r\n  color: #ffc107;\r\n  background-color: rgba(255, 193, 7, 0.1);\r\n}\r\n\r\n.action-retrait {\r\n  color: #fd7e14;\r\n  background-color: rgba(253, 126, 20, 0.1);\r\n}\r\n\r\n.action-validation {\r\n  color: #20c997;\r\n  background-color: rgba(32, 201, 151, 0.1);\r\n}\r\n\r\n.action-notation {\r\n  color: #6f42c1;\r\n  background-color: rgba(111, 66, 193, 0.1);\r\n}\r\n\r\n.action-commentaire {\r\n  color: #007bff;\r\n  background-color: rgba(0, 123, 255, 0.1);\r\n}\r\n\r\n.action-utilisation {\r\n  color: #6610f2;\r\n  background-color: rgba(102, 16, 242, 0.1);\r\n}\r\n\r\n.pagination {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 20px;\r\n}\r\n\r\n.page-btn {\r\n  padding: 8px 16px;\r\n  border: none;\r\n  border-radius: 4px;\r\n  background-color: #2c5038;\r\n  color: white;\r\n  cursor: pointer;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.page-btn:disabled {\r\n  background-color: #ccc;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.page-info {\r\n  color: #666;\r\n}\r\n\r\n/* Animation pour l'expansion */\r\n.timeline-container {\r\n  transition: all 0.3s ease-in-out;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .history-container {\r\n    padding: 10px;\r\n  }\r\n\r\n  .user-header,\r\n  .category-header {\r\n    padding: 10px;\r\n  }\r\n\r\n  .timeline-container {\r\n    padding: 10px;\r\n  }\r\n\r\n  .action-header {\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n    gap: 5px;\r\n  }\r\n\r\n  .action-meta {\r\n    flex-direction: column;\r\n  }\r\n}\r\n\r\n.no-results {\r\n  background-color: white;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n  text-align: center;\r\n  margin: 20px 0;\r\n  color: #666;\r\n  font-size: 1.1rem;\r\n}\r\n\r\n.filtered-indication {\r\n  font-size: 0.8rem;\r\n  font-style: italic;\r\n  color: #666;\r\n}\r\n\r\n.error-message {\r\n  background: #ffe4e6;\r\n  color: #b91c1c;\r\n  border: 1px solid #fca5a5;\r\n  padding: 12px 18px;\r\n  border-radius: 8px;\r\n  margin-bottom: 18px;\r\n  font-weight: 600;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  font-size: 1.1rem;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}