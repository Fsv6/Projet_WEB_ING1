{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelSelect as _vModelSelect, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"explore-page\"\n};\nconst _hoisted_2 = {\n  class: \"filters\"\n};\nconst _hoisted_3 = [\"value\"];\nconst _hoisted_4 = {\n  class: \"object-grid\"\n};\nconst _hoisted_5 = [\"disabled\", \"onClick\"];\nconst _hoisted_6 = [\"disabled\", \"title\", \"onClick\"];\nconst _hoisted_7 = {\n  class: \"daily-recipe-widget\"\n};\nconst _hoisted_8 = {\n  key: 0\n};\nconst _hoisted_9 = {\n  key: 1,\n  class: \"blur\"\n};\nconst _hoisted_10 = {\n  key: 2,\n  class: \"locked-info\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createBlock($setup[\"AppLayout\"], null, {\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [_cache[9] || (_cache[9] = _createElementVNode(\"h1\", null, \"Explorer les objets connect√©s\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_2, [_withDirectives(_createElementVNode(\"input\", {\n      \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.search = $event),\n      placeholder: \"Recherche par nom...\"\n    }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.search]]), _withDirectives(_createElementVNode(\"select\", {\n      \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.selectedType = $event)\n    }, [_cache[2] || (_cache[2] = _createElementVNode(\"option\", {\n      value: \"\"\n    }, \"Tous les types\", -1 /* HOISTED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.uniqueTypes, type => {\n      return _openBlock(), _createElementBlock(\"option\", {\n        key: type,\n        value: type\n      }, _toDisplayString(type), 9 /* TEXT, PROPS */, _hoisted_3);\n    }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, $setup.selectedType]])]), _createElementVNode(\"div\", _hoisted_4, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.filteredObjects, obj => {\n      return _openBlock(), _createElementBlock(\"div\", {\n        key: obj._id,\n        class: \"object-card\"\n      }, [_createElementVNode(\"h3\", null, _toDisplayString(obj.nom), 1 /* TEXT */), _createCommentVNode(\" Flouter les infos si visiteur \"), _createElementVNode(\"div\", {\n        class: _normalizeClass({\n          'blur': $setup.isVisiteur\n        })\n      }, [_createElementVNode(\"p\", null, _toDisplayString(obj.description), 1 /* TEXT */), _createElementVNode(\"p\", null, \"√âtat : \" + _toDisplayString(obj.statut), 1 /* TEXT */), _createElementVNode(\"p\", null, [_cache[3] || (_cache[3] = _createTextVNode(\" üîí Niveau de danger : \")), _createElementVNode(\"span\", {\n        class: _normalizeClass(['badge', obj.niveauDanger])\n      }, _toDisplayString(obj.niveauDanger), 3 /* TEXT, CLASS */)])], 2 /* CLASS */), _createCommentVNode(\" Bouton consulter \"), _createElementVNode(\"button\", {\n        class: \"btn\",\n        disabled: $setup.isVisiteur,\n        onClick: $event => $setup.handleConsultation(obj._id)\n      }, \" Consulter infos \", 8 /* PROPS */, _hoisted_5), _createCommentVNode(\" Bouton contr√¥ler \"), _createElementVNode(\"button\", {\n        class: \"btn\",\n        disabled: !$setup.peutControler(obj),\n        title: !$setup.peutControler(obj) ? 'Contr√¥le non autoris√© √† ton niveau' : '',\n        onClick: $event => $setup.peutControler(obj) && $setup.controlObject(obj)\n      }, \" Contr√¥ler cet objet \", 8 /* PROPS */, _hoisted_6)]);\n    }), 128 /* KEYED_FRAGMENT */))]), _createElementVNode(\"div\", _hoisted_7, [_cache[8] || (_cache[8] = _createElementVNode(\"h2\", null, \"üçΩÔ∏è Recette du jour\", -1 /* HOISTED */)), !$setup.isVisiteur ? (_openBlock(), _createElementBlock(\"div\", _hoisted_8, _cache[4] || (_cache[4] = [_createElementVNode(\"h3\", null, \"Tajine aux l√©gumes r√¥tis\", -1 /* HOISTED */), _createElementVNode(\"p\", null, \"Une recette √©quilibr√©e pour tirer le meilleur de votre four connect√©.\", -1 /* HOISTED */)]))) : (_openBlock(), _createElementBlock(\"div\", _hoisted_9, _cache[5] || (_cache[5] = [_createElementVNode(\"p\", null, \"üîí Recette r√©serv√©e aux utilisateurs inscrits\", -1 /* HOISTED */)]))), $setup.isVisiteur ? (_openBlock(), _createElementBlock(\"p\", _hoisted_10, [_cache[7] || (_cache[7] = _createTextVNode(\" üîí Cr√©ez un compte pour d√©couvrir cette recette ! \")), _createVNode(_component_router_link, {\n      to: \"/register\",\n      class: \"link\"\n    }, {\n      default: _withCtx(() => _cache[6] || (_cache[6] = [_createTextVNode(\"S‚Äôinscrire\")])),\n      _: 1 /* STABLE */\n    })])) : _createCommentVNode(\"v-if\", true)])])]),\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["class","key","_createBlock","$setup","default","_withCtx","_createElementVNode","_hoisted_1","_hoisted_2","_cache","$event","search","placeholder","selectedType","value","_createElementBlock","_Fragment","_renderList","uniqueTypes","type","_hoisted_3","_hoisted_4","filteredObjects","obj","_id","_toDisplayString","nom","_createCommentVNode","_normalizeClass","isVisiteur","description","statut","_createTextVNode","niveauDanger","disabled","onClick","handleConsultation","_hoisted_5","peutControler","title","controlObject","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_createVNode","_component_router_link","to","_"],"sources":["C:\\Users\\benab\\Desktop\\COURS 24_25\\S2\\WEB\\V4\\Projet_WEB_ING1\\frontend\\src\\views\\ExploreApp.vue"],"sourcesContent":["<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useObjetsStore } from '@/stores/objetsStore'\r\nimport { useAuthStore } from '@/stores/auth'\r\nimport AppLayout from '@/layout/AppLayoutGlobal.vue'\r\nimport api from '../services/api'\r\nimport {useRouter} from \"vue-router\";\r\nconst router = useRouter()\r\n\r\nconst objetsStore = useObjetsStore()\r\nconst auth = useAuthStore()\r\nconst isVisiteur = computed(() => auth.role === 'visiteur')\r\n\r\nonMounted(() => {\r\n  objetsStore.fetchObjets()\r\n})\r\n\r\nconst search = ref('')\r\nconst selectedType = ref('')\r\n\r\nconst filteredObjects = computed(() =>\r\n    objetsStore.objets.filter(obj =>\r\n        (!selectedType.value || obj.type === selectedType.value) &&\r\n        (!search.value || obj.nom.toLowerCase().includes(search.value.toLowerCase()))\r\n    )\r\n)\r\n\r\nconst uniqueTypes = computed(() =>\r\n    [...new Set(objetsStore.objets.map(o => o.type))].filter(Boolean)\r\n)\r\n\r\n\r\n\r\nconst handleConsultation = async (id) => {\r\n  try {\r\n    if (auth.role !== 'visiteur') {\r\n      await api.post(`/users/${auth.userId}/points`, { amount: 0.5 });\r\n      auth.points += 0.5;\r\n      localStorage.setItem('points', auth.points);\r\n    }\r\n    router.push(`/objects/${id}`);\r\n  } catch (err) {\r\n    console.warn(\"Erreur lors de l'ajout de points √† la consultation\", err);\r\n    router.push(`/objects/${id}`);\r\n  }\r\n}\r\n\r\nfunction peutControler(objet) {\r\n  const niveau = auth.niveau\r\n  const role = auth.role\r\n  const danger = objet.niveauDanger // ‚Üê champ envoy√© par l'API\r\n\r\n  if (role === 'admin' || role === 'complexe') return true\r\n  if (role === 'simple' && niveau === 'interm√©diaire' && danger === 'faible') return true\r\n  return false\r\n}\r\n\r\n\r\nfunction controlObject(obj) {\r\n  router.push(`/objects/${obj._id}/control`);\r\n}\r\n\r\n</script>\r\n<template>\r\n  <AppLayout>\r\n    <div class=\"explore-page\">\r\n      <h1>Explorer les objets connect√©s</h1>\r\n\r\n      <div class=\"filters\">\r\n        <input v-model=\"search\" placeholder=\"Recherche par nom...\" />\r\n        <select v-model=\"selectedType\">\r\n          <option value=\"\">Tous les types</option>\r\n          <option v-for=\"type in uniqueTypes\" :key=\"type\" :value=\"type\">{{ type }}</option>\r\n        </select>\r\n      </div>\r\n\r\n      <div class=\"object-grid\">\r\n        <div v-for=\"obj in filteredObjects\" :key=\"obj._id\" class=\"object-card\">\r\n          <h3>{{ obj.nom }}</h3>\r\n\r\n          <!-- Flouter les infos si visiteur -->\r\n          <div :class=\"{ 'blur': isVisiteur }\">\r\n            <p>{{ obj.description }}</p>\r\n            <p>√âtat : {{ obj.statut }}</p>\r\n            <p>\r\n              üîí Niveau de danger :\r\n              <span :class=\"['badge', obj.niveauDanger]\">\r\n                {{ obj.niveauDanger }}\r\n              </span>\r\n            </p>\r\n          </div>\r\n\r\n          <!-- Bouton consulter -->\r\n          <button\r\n              class=\"btn\"\r\n              :disabled=\"isVisiteur\"\r\n              @click=\"handleConsultation(obj._id)\"\r\n          >\r\n            Consulter infos\r\n          </button>\r\n\r\n          <!-- Bouton contr√¥ler -->\r\n          <button\r\n              class=\"btn\"\r\n              :disabled=\"!peutControler(obj)\"\r\n              :title=\"!peutControler(obj) ? 'Contr√¥le non autoris√© √† ton niveau' : ''\"\r\n              @click=\"peutControler(obj) && controlObject(obj)\"\r\n          >\r\n            Contr√¥ler cet objet\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"daily-recipe-widget\">\r\n        <h2>üçΩÔ∏è Recette du jour</h2>\r\n\r\n        <div v-if=\"!isVisiteur\">\r\n          <h3>Tajine aux l√©gumes r√¥tis</h3>\r\n          <p>Une recette √©quilibr√©e pour tirer le meilleur de votre four connect√©.</p>\r\n        </div>\r\n        <div v-else class=\"blur\">\r\n          <p>üîí Recette r√©serv√©e aux utilisateurs inscrits</p>\r\n        </div>\r\n\r\n        <p v-if=\"isVisiteur\" class=\"locked-info\">\r\n          üîí Cr√©ez un compte pour d√©couvrir cette recette !\r\n          <router-link to=\"/register\" class=\"link\">S‚Äôinscrire</router-link>\r\n        </p>\r\n      </div>\r\n    </div>\r\n  </AppLayout>\r\n</template>\r\n\r\n\r\n<style scoped>\r\n\r\n.badge {\r\n  padding: 2px 8px;\r\n  border-radius: 8px;\r\n  font-weight: bold;\r\n  font-size: 0.85em;\r\n  display: inline-block;\r\n  margin-left: 6px;\r\n}\r\n\r\n.badge.faible {\r\n  background-color: #e0f7e9;\r\n  color: #007b39;\r\n}\r\n\r\n.badge.√©lev√© {\r\n  background-color: #ffe0e0;\r\n  color: #b00000;\r\n}\r\n\r\n.explore-page {\r\n  max-width: 1000px;\r\n  margin: 0 auto;\r\n}\r\n\r\nh1 {\r\n  margin-bottom: 1rem;\r\n  color: #006d77;\r\n}\r\n\r\n/* ‚úÖ Banni√®re info */\r\n.info-banner {\r\n  background-color: #e0f7fa;\r\n  color: #006064;\r\n  padding: 10px 15px;\r\n  border-radius: 6px;\r\n  font-size: 0.95rem;\r\n  margin-bottom: 1.5rem;\r\n  text-align: center;\r\n}\r\n\r\n.cta-link {\r\n  margin-left: 10px;\r\n  color: #00796b;\r\n  font-weight: bold;\r\n  text-decoration: underline;\r\n}\r\n\r\n.filters {\r\n  display: flex;\r\n  gap: 1rem;\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.filters input,\r\n.filters select {\r\n  padding: 10px;\r\n  border-radius: 6px;\r\n  border: 1px solid #ccc;\r\n  font-size: 1rem;\r\n  width: 100%;\r\n  max-width: 300px;\r\n}\r\n\r\n.object-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\r\n  gap: 1.5rem;\r\n}\r\n\r\n.object-card {\r\n  background: white;\r\n  border-radius: 12px;\r\n  padding: 1.2rem;\r\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n  position: relative;\r\n  transition: transform 0.2s ease;\r\n}\r\n\r\n.object-card:hover {\r\n  transform: translateY(-4px);\r\n}\r\n\r\n\r\n.blur {\r\n  filter: blur(4px);\r\n  user-select: none;\r\n  cursor: default;\r\n}\r\n\r\n.locked-info {\r\n  font-size: 0.85rem;\r\n  margin-top: 10px;\r\n  color: #555;\r\n  text-align: center;\r\n}\r\n\r\n.locked-info .link {\r\n  color: #006d77;\r\n  font-weight: bold;\r\n  margin-left: 5px;\r\n  text-decoration: underline;\r\n}\r\n\r\n.daily-recipe-widget {\r\n  margin-top: 3rem;\r\n  padding: 1.5rem;\r\n  background-color: #fefefe;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 10px rgba(0,0,0,0.05);\r\n  text-align: center;\r\n}\r\n\r\n.daily-recipe-widget h2 {\r\n  margin-bottom: 1rem;\r\n  color: #006d77;\r\n}\r\n\r\n.daily-recipe-widget h3 {\r\n  font-size: 1.25rem;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.locked-info {\r\n  font-size: 0.85rem;\r\n  margin-top: 10px;\r\n  color: #555;\r\n}\r\n\r\n.locked-info .link {\r\n  color: #006d77;\r\n  font-weight: bold;\r\n  margin-left: 5px;\r\n  text-decoration: underline;\r\n}\r\n\r\n.disabled-button {\r\n  background-color: #ccc;\r\n  border: none;\r\n  padding: 8px 12px;\r\n  border-radius: 6px;\r\n  color: #666;\r\n  cursor: not-allowed;\r\n  font-weight: bold;\r\n  margin-top: 10px;\r\n  width: 100%;\r\n  max-width: 250px;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  display: block;\r\n}\r\n\r\n\r\n\r\n\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}