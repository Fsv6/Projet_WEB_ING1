{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"object-activity-page\"\n};\nconst _hoisted_2 = {\n  class: \"header\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"loading\"\n};\nconst _hoisted_4 = {\n  key: 1,\n  class: \"error\"\n};\nconst _hoisted_5 = {\n  key: 2,\n  class: \"activity-content\"\n};\nconst _hoisted_6 = {\n  class: \"overview-section\"\n};\nconst _hoisted_7 = {\n  class: \"stats-grid\"\n};\nconst _hoisted_8 = {\n  class: \"stat-card\"\n};\nconst _hoisted_9 = {\n  class: \"stat-value\"\n};\nconst _hoisted_10 = {\n  class: \"stat-card\"\n};\nconst _hoisted_11 = {\n  class: \"stat-value\"\n};\nconst _hoisted_12 = {\n  class: \"stat-card\"\n};\nconst _hoisted_13 = {\n  class: \"stat-value\"\n};\nconst _hoisted_14 = {\n  class: \"chart-section\"\n};\nconst _hoisted_15 = {\n  key: 0,\n  class: \"no-data\"\n};\nconst _hoisted_16 = {\n  key: 1,\n  class: \"chart-container\"\n};\nconst _hoisted_17 = {\n  ref: \"usageChart\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createBlock($setup[\"AppLayout\"], null, {\n    default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_router_link, {\n      to: \"/manage/objects\"\n    }, {\n      default: _withCtx(() => _cache[0] || (_cache[0] = [_createElementVNode(\"button\", {\n        class: \"btn-retour\"\n      }, \"‚Üê Retour √† la gestion des objets\", -1 /* HOISTED */)])),\n      _: 1 /* STABLE */\n    }), _createElementVNode(\"h1\", null, \"üìä Activit√© de l'objet : \" + _toDisplayString($setup.object?.nom || 'Chargement...'), 1 /* TEXT */)]), $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, _cache[1] || (_cache[1] = [_createElementVNode(\"div\", {\n      class: \"spinner\"\n    }, null, -1 /* HOISTED */), _createElementVNode(\"p\", null, \"Chargement des donn√©es...\", -1 /* HOISTED */)]))) : $setup.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createElementVNode(\"p\", null, _toDisplayString($setup.error), 1 /* TEXT */), _createElementVNode(\"button\", {\n      onClick: $setup.loadData,\n      class: \"retry-btn\"\n    }, _cache[2] || (_cache[2] = [_createElementVNode(\"i\", {\n      class: \"fas fa-sync-alt\"\n    }, null, -1 /* HOISTED */), _createTextVNode(\" R√©essayer \")]))])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createCommentVNode(\" Vue d'ensemble \"), _createElementVNode(\"div\", _hoisted_6, [_cache[6] || (_cache[6] = _createElementVNode(\"h2\", null, \"Vue d'ensemble\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"div\", _hoisted_8, [_cache[3] || (_cache[3] = _createElementVNode(\"h3\", null, \"Utilisations totales\", -1 /* HOISTED */)), _createElementVNode(\"p\", _hoisted_9, _toDisplayString($setup.stats.totalUtilisations), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_10, [_cache[4] || (_cache[4] = _createElementVNode(\"h3\", null, \"Temps d'utilisation moyen\", -1 /* HOISTED */)), _createElementVNode(\"p\", _hoisted_11, _toDisplayString($setup.stats.tempsMoyen || 0) + \" min\", 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_12, [_cache[5] || (_cache[5] = _createElementVNode(\"h3\", null, \"Derni√®re utilisation\", -1 /* HOISTED */)), _createElementVNode(\"p\", _hoisted_13, _toDisplayString($setup.formatDate($setup.stats.derniereUtilisation)), 1 /* TEXT */)])])]), _createCommentVNode(\" Graphique d'utilisation par membre de la famille \"), _createElementVNode(\"div\", _hoisted_14, [_cache[8] || (_cache[8] = _createElementVNode(\"h2\", null, \"Utilisation par membre de la famille\", -1 /* HOISTED */)), !$setup.stats.usageParMembre || $setup.stats.usageParMembre.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_15, _cache[7] || (_cache[7] = [_createElementVNode(\"p\", null, \"Aucune donn√©e d'utilisation disponible pour cet objet\", -1 /* HOISTED */)]))) : (_openBlock(), _createElementBlock(\"div\", _hoisted_16, [_createElementVNode(\"canvas\", _hoisted_17, null, 512 /* NEED_PATCH */)]))])]))])]),\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["class","key","ref","_createBlock","$setup","default","_withCtx","_createElementVNode","_hoisted_1","_hoisted_2","_createVNode","_component_router_link","to","_cache","_","_toDisplayString","object","nom","loading","_createElementBlock","_hoisted_3","error","_hoisted_4","onClick","loadData","_createTextVNode","_hoisted_5","_createCommentVNode","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","stats","totalUtilisations","_hoisted_10","_hoisted_11","tempsMoyen","_hoisted_12","_hoisted_13","formatDate","derniereUtilisation","_hoisted_14","usageParMembre","length","_hoisted_15","_hoisted_16","_hoisted_17"],"sources":["C:\\Users\\benab\\Desktop\\COURS 24_25\\S2\\WEB\\V4\\Projet_WEB_ING1\\frontend\\src\\views\\ObjectActivityView.vue"],"sourcesContent":["<template>\r\n  <AppLayout>\r\n    <div class=\"object-activity-page\">\r\n      <div class=\"header\">\r\n        <router-link to=\"/manage/objects\">\r\n          <button class=\"btn-retour\">‚Üê Retour √† la gestion des objets</button>\r\n        </router-link>\r\n        <h1>üìä Activit√© de l'objet : {{ object?.nom || 'Chargement...' }}</h1>\r\n      </div>\r\n\r\n      <div v-if=\"loading\" class=\"loading\">\r\n        <div class=\"spinner\"></div>\r\n        <p>Chargement des donn√©es...</p>\r\n      </div>\r\n\r\n      <div v-else-if=\"error\" class=\"error\">\r\n        <p>{{ error }}</p>\r\n        <button @click=\"loadData\" class=\"retry-btn\">\r\n          <i class=\"fas fa-sync-alt\"></i> R√©essayer\r\n        </button>\r\n      </div>\r\n\r\n      <div v-else class=\"activity-content\">\r\n        <!-- Vue d'ensemble -->\r\n        <div class=\"overview-section\">\r\n          <h2>Vue d'ensemble</h2>\r\n          \r\n          <div class=\"stats-grid\">\r\n            <div class=\"stat-card\">\r\n              <h3>Utilisations totales</h3>\r\n              <p class=\"stat-value\">{{ stats.totalUtilisations }}</p>\r\n            </div>\r\n            <div class=\"stat-card\">\r\n              <h3>Temps d'utilisation moyen</h3>\r\n              <p class=\"stat-value\">{{ stats.tempsMoyen || 0 }} min</p>\r\n            </div>\r\n            <div class=\"stat-card\">\r\n              <h3>Derni√®re utilisation</h3>\r\n              <p class=\"stat-value\">{{ formatDate(stats.derniereUtilisation) }}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Graphique d'utilisation par membre de la famille -->\r\n        <div class=\"chart-section\">\r\n          <h2>Utilisation par membre de la famille</h2>\r\n          <div v-if=\"!stats.usageParMembre || stats.usageParMembre.length === 0\" class=\"no-data\">\r\n            <p>Aucune donn√©e d'utilisation disponible pour cet objet</p>\r\n          </div>\r\n          <div v-else class=\"chart-container\">\r\n            <canvas ref=\"usageChart\"></canvas>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </AppLayout>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, nextTick, onUnmounted } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport AppLayout from '@/layout/AppLayoutGlobal.vue'\r\nimport api from '@/services/api'\r\nimport Chart from 'chart.js/auto'\r\n\r\nconst route = useRoute()\r\nconst object = ref(null)\r\nconst loading = ref(true)\r\nconst error = ref(null)\r\nconst stats = ref({\r\n  totalUtilisations: 0,\r\n  tempsMoyen: 0,\r\n  derniereUtilisation: null,\r\n  usageParMembre: []\r\n})\r\nconst usageChart = ref(null)\r\nconst charts = ref([])\r\n\r\n// Fonction pour formater les dates\r\nconst formatDate = (dateString) => {\r\n  if (!dateString) return 'Jamais'\r\n  return new Date(dateString).toLocaleString('fr-FR')\r\n}\r\n\r\n// Charger les donn√©es de l'objet et des stats\r\nconst loadData = async () => {\r\n  try {\r\n    loading.value = true\r\n    error.value = null\r\n    \r\n    // En-t√™te d'autorisation\r\n    const token = localStorage.getItem('token')\r\n    if (token) {\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`\r\n    }\r\n    \r\n    // Obtenir les donn√©es\r\n    const [objectRes, statsRes] = await Promise.all([\r\n      api.get(`/objets/${route.params.id}`),\r\n      api.get(`/objets/${route.params.id}/stats`)\r\n    ])\r\n\r\n    object.value = objectRes.data\r\n    \r\n    // Fusionner les stats re√ßues avec les valeurs par d√©faut\r\n    if (statsRes.data) {\r\n      stats.value = {\r\n        ...stats.value,\r\n        ...statsRes.data\r\n      }\r\n    }\r\n    \r\n    // Initialiser les graphiques apr√®s avoir charg√© les donn√©es\r\n    nextTick(() => {\r\n      initChart()\r\n    })\r\n  } catch (err) {\r\n    console.error('Erreur lors du chargement des donn√©es:', err)\r\n    error.value = `Erreur lors du chargement des donn√©es: ${err.response?.data?.error || err.message || 'Erreur inconnue'}`\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// D√©truire les graphiques existants pour √©viter les fuites de m√©moire\r\nconst destroyCharts = () => {\r\n  charts.value.forEach(chart => {\r\n    if (chart) chart.destroy()\r\n  })\r\n  charts.value = []\r\n}\r\n\r\n// Initialiser le graphique d'utilisation par membre\r\nconst initChart = () => {\r\n  // Nettoyer les graphiques existants\r\n  destroyCharts()\r\n  \r\n  // S'assurer que l'√©l√©ment Canvas est mont√© dans le DOM\r\n  if (!usageChart.value) {\r\n    console.warn('La r√©f√©rence Canvas n\\'est pas encore disponible')\r\n    return\r\n  }\r\n  \r\n  try {\r\n    // Graphique d'utilisation par membre\r\n    if (stats.value.usageParMembre && stats.value.usageParMembre.length > 0) {\r\n      // Trier les donn√©es par nombre d'utilisations (d√©croissant)\r\n      const sortedData = [...stats.value.usageParMembre].sort((a, b) => b.count - a.count)\r\n      \r\n      const memberChart = new Chart(usageChart.value, {\r\n        type: 'bar',\r\n        data: {\r\n          labels: sortedData.map(m => m.nom || 'Utilisateur'),\r\n          datasets: [{\r\n            label: 'Nombre d\\'utilisations',\r\n            data: sortedData.map(m => m.count || 0),\r\n            backgroundColor: 'rgba(44, 80, 56, 0.6)',\r\n            borderColor: 'rgb(44, 80, 56)',\r\n            borderWidth: 1\r\n          }]\r\n        },\r\n        options: {\r\n          responsive: true,\r\n          maintainAspectRatio: false,\r\n          scales: {\r\n            y: {\r\n              beginAtZero: true,\r\n              title: {\r\n                display: true,\r\n                text: 'Nombre d\\'utilisations'\r\n              }\r\n            },\r\n            x: {\r\n              title: {\r\n                display: true,\r\n                text: 'Membres de la famille'\r\n              }\r\n            }\r\n          },\r\n          plugins: {\r\n            legend: {\r\n              display: false\r\n            },\r\n            title: {\r\n              display: true,\r\n              text: 'Utilisation par membre de la famille',\r\n              font: {\r\n                size: 16\r\n              }\r\n            }\r\n          }\r\n        }\r\n      })\r\n      charts.value.push(memberChart)\r\n    } else {\r\n      // Graphique vide avec message\r\n      const ctx = usageChart.value.getContext('2d')\r\n      ctx.font = '16px Arial'\r\n      ctx.fillStyle = '#666'\r\n      ctx.textAlign = 'center'\r\n      ctx.fillText('Aucune donn√©e disponible', usageChart.value.width / 2, usageChart.value.height / 2)\r\n    }\r\n  } catch (err) {\r\n    console.error('Erreur lors de l\\'initialisation du graphique:', err)\r\n    error.value = `Erreur lors de l'initialisation du graphique: ${err.message}`\r\n  }\r\n}\r\n\r\n// Nettoyer les ressources lors de la destruction du composant\r\nonUnmounted(() => {\r\n  destroyCharts()\r\n})\r\n\r\nonMounted(() => {\r\n  loadData()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.object-activity-page {\r\n  padding: 20px;\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.header {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.btn-retour {\r\n  background-color: #f0f0f0;\r\n  border: none;\r\n  padding: 8px 16px;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.loading {\r\n  text-align: center;\r\n  padding: 40px;\r\n}\r\n\r\n.spinner {\r\n  border: 4px solid #f3f3f3;\r\n  border-top: 4px solid #3498db;\r\n  border-radius: 50%;\r\n  width: 40px;\r\n  height: 40px;\r\n  animation: spin 1s linear infinite;\r\n  margin: 0 auto 20px;\r\n}\r\n\r\n@keyframes spin {\r\n  0% { transform: rotate(0deg); }\r\n  100% { transform: rotate(360deg); }\r\n}\r\n\r\n.error {\r\n  color: #dc3545;\r\n  text-align: center;\r\n  padding: 20px;\r\n}\r\n\r\n.overview-section {\r\n  margin-bottom: 40px;\r\n}\r\n\r\n.stats-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\r\n  gap: 20px;\r\n  margin-top: 20px;\r\n}\r\n\r\n.stat-card {\r\n  background: white;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n  text-align: center;\r\n}\r\n\r\n.stat-value {\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n  color: #2c5038;\r\n  margin-top: 10px;\r\n}\r\n\r\n.chart-section {\r\n  background: white;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n  margin-bottom: 40px;\r\n}\r\n\r\n.chart-container {\r\n  height: 400px;\r\n  margin-top: 20px;\r\n}\r\n\r\n.no-data {\r\n  text-align: center;\r\n  padding: 40px;\r\n  color: #666;\r\n  font-style: italic;\r\n}\r\n\r\n.retry-btn {\r\n  background-color: #3498db;\r\n  color: white;\r\n  border: none;\r\n  padding: 8px 16px;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  margin: 20px auto;\r\n}\r\n\r\n.retry-btn i {\r\n  animation: rotate 2s linear infinite;\r\n}\r\n\r\n@keyframes rotate {\r\n  from { transform: rotate(0deg); }\r\n  to { transform: rotate(360deg); }\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .stats-grid {\r\n    grid-template-columns: repeat(2, 1fr);\r\n  }\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}