{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport { ref, computed, onMounted } from 'vue';\nimport { useObjetsStore } from '@/stores/objetsStore';\nimport { useAuthStore } from '@/stores/auth';\nimport AppLayout from '@/layout/AppLayoutGlobal.vue';\nimport api from '../services/api';\nimport { useRouter } from \"vue-router\";\nexport default {\n  __name: 'ExploreApp',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const router = useRouter();\n    const objetsStore = useObjetsStore();\n    const auth = useAuthStore();\n    const isVisiteur = computed(() => auth.role === 'visiteur');\n    onMounted(() => {\n      objetsStore.fetchObjets();\n    });\n    const search = ref('');\n    const selectedType = ref('');\n    const filteredObjects = computed(() => objetsStore.objets.filter(obj => (!selectedType.value || obj.type === selectedType.value) && (!search.value || obj.nom.toLowerCase().includes(search.value.toLowerCase()))));\n    const uniqueTypes = computed(() => [...new Set(objetsStore.objets.map(o => o.type))].filter(Boolean));\n    const handleConsultation = async id => {\n      try {\n        if (auth.role !== 'visiteur') {\n          await api.post(`/users/${auth.userId}/points`, {\n            amount: 0.5\n          });\n          auth.points += 0.5;\n          localStorage.setItem('points', auth.points);\n        }\n        router.push(`/objects/${id}`);\n      } catch (err) {\n        console.warn(\"Erreur lors de l'ajout de points √† la consultation\", err);\n        router.push(`/objects/${id}`);\n      }\n    };\n    function peutControler(objet) {\n      const niveau = auth.niveau;\n      const role = auth.role;\n      const danger = objet.niveauDanger; // ‚Üê champ envoy√© par l'API\n\n      if (role === 'admin' || role === 'complexe') return true;\n      if (role === 'simple' && niveau === 'interm√©diaire' && danger === 'faible') return true;\n      return false;\n    }\n    function controlObject(obj) {\n      router.push(`/objects/${obj._id}/control`);\n    }\n    const __returned__ = {\n      router,\n      objetsStore,\n      auth,\n      isVisiteur,\n      search,\n      selectedType,\n      filteredObjects,\n      uniqueTypes,\n      handleConsultation,\n      peutControler,\n      controlObject,\n      ref,\n      computed,\n      onMounted,\n      get useObjetsStore() {\n        return useObjetsStore;\n      },\n      get useAuthStore() {\n        return useAuthStore;\n      },\n      AppLayout,\n      get api() {\n        return api;\n      },\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useObjetsStore","useAuthStore","AppLayout","api","useRouter","router","objetsStore","auth","isVisiteur","role","fetchObjets","search","selectedType","filteredObjects","objets","filter","obj","value","type","nom","toLowerCase","includes","uniqueTypes","Set","map","o","Boolean","handleConsultation","id","post","userId","amount","points","localStorage","setItem","push","err","console","warn","peutControler","objet","niveau","danger","niveauDanger","controlObject","_id"],"sources":["C:/Users/benab/Desktop/COURS 24_25/S2/WEB/V4/Projet_WEB_ING1/frontend/src/views/ExploreApp.vue"],"sourcesContent":["<script setup>\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useObjetsStore } from '@/stores/objetsStore'\r\nimport { useAuthStore } from '@/stores/auth'\r\nimport AppLayout from '@/layout/AppLayoutGlobal.vue'\r\nimport api from '../services/api'\r\nimport {useRouter} from \"vue-router\";\r\nconst router = useRouter()\r\n\r\nconst objetsStore = useObjetsStore()\r\nconst auth = useAuthStore()\r\nconst isVisiteur = computed(() => auth.role === 'visiteur')\r\n\r\nonMounted(() => {\r\n  objetsStore.fetchObjets()\r\n})\r\n\r\nconst search = ref('')\r\nconst selectedType = ref('')\r\n\r\nconst filteredObjects = computed(() =>\r\n    objetsStore.objets.filter(obj =>\r\n        (!selectedType.value || obj.type === selectedType.value) &&\r\n        (!search.value || obj.nom.toLowerCase().includes(search.value.toLowerCase()))\r\n    )\r\n)\r\n\r\nconst uniqueTypes = computed(() =>\r\n    [...new Set(objetsStore.objets.map(o => o.type))].filter(Boolean)\r\n)\r\n\r\n\r\n\r\nconst handleConsultation = async (id) => {\r\n  try {\r\n    if (auth.role !== 'visiteur') {\r\n      await api.post(`/users/${auth.userId}/points`, { amount: 0.5 });\r\n      auth.points += 0.5;\r\n      localStorage.setItem('points', auth.points);\r\n    }\r\n    router.push(`/objects/${id}`);\r\n  } catch (err) {\r\n    console.warn(\"Erreur lors de l'ajout de points √† la consultation\", err);\r\n    router.push(`/objects/${id}`);\r\n  }\r\n}\r\n\r\nfunction peutControler(objet) {\r\n  const niveau = auth.niveau\r\n  const role = auth.role\r\n  const danger = objet.niveauDanger // ‚Üê champ envoy√© par l'API\r\n\r\n  if (role === 'admin' || role === 'complexe') return true\r\n  if (role === 'simple' && niveau === 'interm√©diaire' && danger === 'faible') return true\r\n  return false\r\n}\r\n\r\n\r\nfunction controlObject(obj) {\r\n  router.push(`/objects/${obj._id}/control`);\r\n}\r\n\r\n</script>\r\n<template>\r\n  <AppLayout>\r\n    <div class=\"explore-page\">\r\n      <h1>Explorer les objets connect√©s</h1>\r\n\r\n      <div class=\"filters\">\r\n        <input v-model=\"search\" placeholder=\"Recherche par nom...\" />\r\n        <select v-model=\"selectedType\">\r\n          <option value=\"\">Tous les types</option>\r\n          <option v-for=\"type in uniqueTypes\" :key=\"type\" :value=\"type\">{{ type }}</option>\r\n        </select>\r\n      </div>\r\n\r\n      <div class=\"object-grid\">\r\n        <div v-for=\"obj in filteredObjects\" :key=\"obj._id\" class=\"object-card\">\r\n          <h3>{{ obj.nom }}</h3>\r\n\r\n          <!-- Flouter les infos si visiteur -->\r\n          <div :class=\"{ 'blur': isVisiteur }\">\r\n            <p>{{ obj.description }}</p>\r\n            <p>√âtat : {{ obj.statut }}</p>\r\n            <p>\r\n              üîí Niveau de danger :\r\n              <span :class=\"['badge', obj.niveauDanger]\">\r\n                {{ obj.niveauDanger }}\r\n              </span>\r\n            </p>\r\n          </div>\r\n\r\n          <!-- Bouton consulter -->\r\n          <button\r\n              class=\"btn\"\r\n              :disabled=\"isVisiteur\"\r\n              @click=\"handleConsultation(obj._id)\"\r\n          >\r\n            Consulter infos\r\n          </button>\r\n\r\n          <!-- Bouton contr√¥ler -->\r\n          <button\r\n              class=\"btn\"\r\n              :disabled=\"!peutControler(obj)\"\r\n              :title=\"!peutControler(obj) ? 'Contr√¥le non autoris√© √† ton niveau' : ''\"\r\n              @click=\"peutControler(obj) && controlObject(obj)\"\r\n          >\r\n            Contr√¥ler cet objet\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"daily-recipe-widget\">\r\n        <h2>üçΩÔ∏è Recette du jour</h2>\r\n\r\n        <div v-if=\"!isVisiteur\">\r\n          <h3>Tajine aux l√©gumes r√¥tis</h3>\r\n          <p>Une recette √©quilibr√©e pour tirer le meilleur de votre four connect√©.</p>\r\n        </div>\r\n        <div v-else class=\"blur\">\r\n          <p>üîí Recette r√©serv√©e aux utilisateurs inscrits</p>\r\n        </div>\r\n\r\n        <p v-if=\"isVisiteur\" class=\"locked-info\">\r\n          üîí Cr√©ez un compte pour d√©couvrir cette recette !\r\n          <router-link to=\"/register\" class=\"link\">S‚Äôinscrire</router-link>\r\n        </p>\r\n      </div>\r\n    </div>\r\n  </AppLayout>\r\n</template>\r\n\r\n\r\n<style scoped>\r\n\r\n.badge {\r\n  padding: 2px 8px;\r\n  border-radius: 8px;\r\n  font-weight: bold;\r\n  font-size: 0.85em;\r\n  display: inline-block;\r\n  margin-left: 6px;\r\n}\r\n\r\n.badge.faible {\r\n  background-color: #e0f7e9;\r\n  color: #007b39;\r\n}\r\n\r\n.badge.√©lev√© {\r\n  background-color: #ffe0e0;\r\n  color: #b00000;\r\n}\r\n\r\n.explore-page {\r\n  max-width: 1000px;\r\n  margin: 0 auto;\r\n}\r\n\r\nh1 {\r\n  margin-bottom: 1rem;\r\n  color: #006d77;\r\n}\r\n\r\n/* ‚úÖ Banni√®re info */\r\n.info-banner {\r\n  background-color: #e0f7fa;\r\n  color: #006064;\r\n  padding: 10px 15px;\r\n  border-radius: 6px;\r\n  font-size: 0.95rem;\r\n  margin-bottom: 1.5rem;\r\n  text-align: center;\r\n}\r\n\r\n.cta-link {\r\n  margin-left: 10px;\r\n  color: #00796b;\r\n  font-weight: bold;\r\n  text-decoration: underline;\r\n}\r\n\r\n.filters {\r\n  display: flex;\r\n  gap: 1rem;\r\n  margin-bottom: 2rem;\r\n}\r\n\r\n.filters input,\r\n.filters select {\r\n  padding: 10px;\r\n  border-radius: 6px;\r\n  border: 1px solid #ccc;\r\n  font-size: 1rem;\r\n  width: 100%;\r\n  max-width: 300px;\r\n}\r\n\r\n.object-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\r\n  gap: 1.5rem;\r\n}\r\n\r\n.object-card {\r\n  background: white;\r\n  border-radius: 12px;\r\n  padding: 1.2rem;\r\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n  position: relative;\r\n  transition: transform 0.2s ease;\r\n}\r\n\r\n.object-card:hover {\r\n  transform: translateY(-4px);\r\n}\r\n\r\n\r\n.blur {\r\n  filter: blur(4px);\r\n  user-select: none;\r\n  cursor: default;\r\n}\r\n\r\n.locked-info {\r\n  font-size: 0.85rem;\r\n  margin-top: 10px;\r\n  color: #555;\r\n  text-align: center;\r\n}\r\n\r\n.locked-info .link {\r\n  color: #006d77;\r\n  font-weight: bold;\r\n  margin-left: 5px;\r\n  text-decoration: underline;\r\n}\r\n\r\n.daily-recipe-widget {\r\n  margin-top: 3rem;\r\n  padding: 1.5rem;\r\n  background-color: #fefefe;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 10px rgba(0,0,0,0.05);\r\n  text-align: center;\r\n}\r\n\r\n.daily-recipe-widget h2 {\r\n  margin-bottom: 1rem;\r\n  color: #006d77;\r\n}\r\n\r\n.daily-recipe-widget h3 {\r\n  font-size: 1.25rem;\r\n  margin-bottom: 0.5rem;\r\n}\r\n\r\n.locked-info {\r\n  font-size: 0.85rem;\r\n  margin-top: 10px;\r\n  color: #555;\r\n}\r\n\r\n.locked-info .link {\r\n  color: #006d77;\r\n  font-weight: bold;\r\n  margin-left: 5px;\r\n  text-decoration: underline;\r\n}\r\n\r\n.disabled-button {\r\n  background-color: #ccc;\r\n  border: none;\r\n  padding: 8px 12px;\r\n  border-radius: 6px;\r\n  color: #666;\r\n  cursor: not-allowed;\r\n  font-weight: bold;\r\n  margin-top: 10px;\r\n  width: 100%;\r\n  max-width: 250px;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  display: block;\r\n}\r\n\r\n\r\n\r\n\r\n</style>\r\n"],"mappings":";;;;;;;;;;;AACA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,KAAK;AAC9C,SAASC,cAAc,QAAQ,sBAAsB;AACrD,SAASC,YAAY,QAAQ,eAAe;AAC5C,OAAOC,SAAS,MAAM,8BAA8B;AACpD,OAAOC,GAAG,MAAM,iBAAiB;AACjC,SAAQC,SAAS,QAAO,YAAY;;;;;;;IACpC,MAAMC,MAAM,GAAGD,SAAS,CAAC,CAAC;IAE1B,MAAME,WAAW,GAAGN,cAAc,CAAC,CAAC;IACpC,MAAMO,IAAI,GAAGN,YAAY,CAAC,CAAC;IAC3B,MAAMO,UAAU,GAAGV,QAAQ,CAAC,MAAMS,IAAI,CAACE,IAAI,KAAK,UAAU,CAAC;IAE3DV,SAAS,CAAC,MAAM;MACdO,WAAW,CAACI,WAAW,CAAC,CAAC;IAC3B,CAAC,CAAC;IAEF,MAAMC,MAAM,GAAGd,GAAG,CAAC,EAAE,CAAC;IACtB,MAAMe,YAAY,GAAGf,GAAG,CAAC,EAAE,CAAC;IAE5B,MAAMgB,eAAe,GAAGf,QAAQ,CAAC,MAC7BQ,WAAW,CAACQ,MAAM,CAACC,MAAM,CAACC,GAAG,IACzB,CAAC,CAACJ,YAAY,CAACK,KAAK,IAAID,GAAG,CAACE,IAAI,KAAKN,YAAY,CAACK,KAAK,MACtD,CAACN,MAAM,CAACM,KAAK,IAAID,GAAG,CAACG,GAAG,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAACV,MAAM,CAACM,KAAK,CAACG,WAAW,CAAC,CAAC,CAAC,CAChF,CACJ,CAAC;IAED,MAAME,WAAW,GAAGxB,QAAQ,CAAC,MACzB,CAAC,GAAG,IAAIyB,GAAG,CAACjB,WAAW,CAACQ,MAAM,CAACU,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACP,IAAI,CAAC,CAAC,CAAC,CAACH,MAAM,CAACW,OAAO,CACpE,CAAC;IAID,MAAMC,kBAAkB,GAAG,MAAOC,EAAE,IAAK;MACvC,IAAI;QACF,IAAIrB,IAAI,CAACE,IAAI,KAAK,UAAU,EAAE;UAC5B,MAAMN,GAAG,CAAC0B,IAAI,CAAC,UAAUtB,IAAI,CAACuB,MAAM,SAAS,EAAE;YAAEC,MAAM,EAAE;UAAI,CAAC,CAAC;UAC/DxB,IAAI,CAACyB,MAAM,IAAI,GAAG;UAClBC,YAAY,CAACC,OAAO,CAAC,QAAQ,EAAE3B,IAAI,CAACyB,MAAM,CAAC;QAC7C;QACA3B,MAAM,CAAC8B,IAAI,CAAC,YAAYP,EAAE,EAAE,CAAC;MAC/B,CAAC,CAAC,OAAOQ,GAAG,EAAE;QACZC,OAAO,CAACC,IAAI,CAAC,oDAAoD,EAAEF,GAAG,CAAC;QACvE/B,MAAM,CAAC8B,IAAI,CAAC,YAAYP,EAAE,EAAE,CAAC;MAC/B;IACF,CAAC;IAED,SAASW,aAAaA,CAACC,KAAK,EAAE;MAC5B,MAAMC,MAAM,GAAGlC,IAAI,CAACkC,MAAM;MAC1B,MAAMhC,IAAI,GAAGF,IAAI,CAACE,IAAI;MACtB,MAAMiC,MAAM,GAAGF,KAAK,CAACG,YAAY,EAAC;;MAElC,IAAIlC,IAAI,KAAK,OAAO,IAAIA,IAAI,KAAK,UAAU,EAAE,OAAO,IAAI;MACxD,IAAIA,IAAI,KAAK,QAAQ,IAAIgC,MAAM,KAAK,eAAe,IAAIC,MAAM,KAAK,QAAQ,EAAE,OAAO,IAAI;MACvF,OAAO,KAAK;IACd;IAGA,SAASE,aAAaA,CAAC5B,GAAG,EAAE;MAC1BX,MAAM,CAAC8B,IAAI,CAAC,YAAYnB,GAAG,CAAC6B,GAAG,UAAU,CAAC;IAC5C","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}